<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>스코어 입력</title>
<style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f0f0f0;
    }
    .section {
      margin-bottom: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"], select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .button-group button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
    }
    .checkbox-group label {
      margin-right: 10px;
    }
  
.status-alert {
  color: red;
  font-weight: bold;
  animation: flash 0.3s ease-in-out 2;
}
@keyframes flash {
  0% { background-color: yellow; }
  50% { background-color: transparent; }
  100% { background-color: yellow; }
}

.status-alert {
  color: red;
  font-weight: bold;
  animation: flash 0.3s ease-in-out 2;
}
@keyframes flash {
  0% { background-color: yellow; }
  50% { background-color: transparent; }
  100% { background-color: yellow; }
}
</style>
</head>
<body>
<h1>스코어보드 입력</h1>
<div class="section">
<label>팀명</label>
<input id="team1" oninput="send('team1', this.value)" placeholder="화식초" type="text"/><button onclick="document.getElementById('team1').value=''; localStorage.removeItem('team1'); document.getElementById('label1').textContent = '팀명1:'">리셋</button>
<input id="team2" oninput="send('team2', this.value)" placeholder="명식초" type="text"/><button onclick="document.getElementById('team2').value=''; localStorage.removeItem('team2'); document.getElementById('label2').textContent = '팀명2:'">리셋</button>
</div>
<div class="section">
<label>점수 조정</label>
<div class="button-group">
<span id="label1"><span class="score1-label">화식초</span>:</span>
<button onclick="adjustScore('score1', 1)">+</button>
<button onclick="adjustScore('score1', -1)">-</button>
<span id="label2"><span class="score2-label">명식초</span>:</span>
<button onclick="adjustScore('score2', 1)">+</button>
<button onclick="adjustScore('score2', -1)">-</button>
</div>
<button onclick="localStorage.removeItem('score1'); localStorage.removeItem('score2')">리셋</button><div id="score_status" style="margin-top: 5px; font-weight: bold;">점수 상태 - <span class="score1-label">화식초</span>: 0 / <span class="score2-label">명식초</span>: 0</div></div>
<div class="section">
<label>볼카운트</label>
<div class="button-group">
<span>볼:</span>
<button onclick="adjustCount('ball', 1)">+</button>
<button onclick="adjustCount('ball', -1)">-</button>
<span>스트라이크:</span>
<button onclick="adjustCount('strike', 1)">+</button>
<button onclick="adjustCount('strike', -1)">-</button>
</div>
<button onclick="localStorage.removeItem('ball'); localStorage.removeItem('strike')">리셋</button><div id="ball_status" style="margin-top: 5px; font-weight: bold;">볼카운트 상태: 0</div><div id="strike_status" style="margin-top: 5px; font-weight: bold;">스트라이크 상태: 0</div></div>
<div class="section">
<label>아웃</label>
<div class="button-group">
<button onclick="adjustCount('out', 1)">+</button>
<button onclick="adjustCount('out', -1)">-</button>
</div>
<button onclick="localStorage.removeItem('out')">리셋</button><div id="out_status" style="margin-top: 5px; font-weight: bold;">아웃 상태: 0</div></div>
<div class="section">
<label id="inning_label">이닝</label>
<button onclick="localStorage.removeItem('inning')">리셋</button><div class="button-group"><button onclick="adjustInning(-1)">-</button><button onclick="adjustInning(1)">+</button></div><div id="inning_status" style="margin-top: 5px; font-weight: bold;">이닝 상태: 0</div></div>
<div class="section">
<label>주루상황</label>
<div class="checkbox-group">
<label><input id="base1" onchange="send('base1', this.checked)" type="checkbox"/> 1루</label>
<label><input id="base2" onchange="send('base2', this.checked)" type="checkbox"/> 2루</label>
<label><input id="base3" onchange="send('base3', this.checked)" type="checkbox"/> 3루</label>
</div>
<button onclick="localStorage.removeItem('base1'); localStorage.removeItem('base2'); localStorage.removeItem('base3')">리셋</button></div>
<script>
function updateStatusDisplay() {
  document.getElementById("ball_status").textContent = "볼카운트 상태: " + (localStorage.getItem("ball") || 0);
  document.getElementById("strike_status").textContent = "스트라이크 상태: " + (localStorage.getItem("strike") || 0);
  document.getElementById("out_status").textContent = "아웃 상태: " + (localStorage.getItem("out") || 0);
  document.getElementById("inning_status").textContent = "이닝 상태: " + (localStorage.getItem("inning") || "1회초");
  document.getElementById("score_status").textContent = "점수 상태 - <span id="score1-label">화식초</span>: " + (localStorage.getItem("score1") || 0) + " / <span id="score2-label">명식초</span>: " + (localStorage.getItem("score2") || 0);

  // 주루상황 체크박스 동기화
  ['base1', 'base2', 'base3'].forEach(id => {
    document.getElementById(id).checked = localStorage.getItem(id) === "true";
  });

  // 아웃 공 두 개 상태 표시용
  const outSection = document.getElementById("out_status");
  if (outSection) {
    const outCount = parseInt(localStorage.getItem("out") || "0");
    let html = "아웃 상태: ";
    for (let i = 0; i < 2; i++) {
      html += `<span style="display:inline-block;width:12px;height:12px;margin:2px;border-radius:50%;background-color:${i &lt; outCount ? 'red' : '#ddd'};"></span>`;
    }
    outSection.innerHTML = html;
  }
}

function highlightEffect(id) {
  const el = document.getElementById(id);
  el.classList.add("status-alert");
  setTimeout(() => el.classList.remove("status-alert"), 800);
}

function adjustScore(id, change) {
  let el = localStorage.getItem(id) || "0";
  let newVal = Math.max(0, parseInt(el) + change);
  localStorage.setItem(id, newVal);
  updateStatusDisplay();
}

function adjustCount(type, change) {
  let value = parseInt(localStorage.getItem(type) || "0");
  if (type === "strike") {
    if (value >= 2 && change > 0) {
      localStorage.setItem("strike", 0);
      localStorage.setItem("ball", 0);
      highlightEffect("strike_status");
      highlightEffect("ball_status");
      let out = parseInt(localStorage.getItem("out") || "0") + 1;
      localStorage.setItem("out", out);
      highlightEffect("out_status");
      if (out >= 3) {
        incrementInning();
        localStorage.setItem("out", 0);
        localStorage.setItem("ball", 0);
        localStorage.setItem("strike", 0);
        localStorage.setItem("base1", false);
        localStorage.setItem("base2", false);
        localStorage.setItem("base3", false);
        highlightEffect("inning_status");
      }
    } else {
      value = Math.min(2, Math.max(0, value + change));
      localStorage.setItem(type, value);
    }
  } else if (type === "ball") {
    if (value >= 3 && change > 0) {
      localStorage.setItem("ball", 0);
      localStorage.setItem("strike", 0);
      highlightEffect("ball_status");
      highlightEffect("strike_status");
    } else {
      value = Math.min(3, Math.max(0, value + change));
      localStorage.setItem(type, value);
    }
  } else if (type === "out") {
    value = Math.min(3, Math.max(0, value + change));
    localStorage.setItem(type, value);
  }
  updateStatusDisplay();
}

function incrementInning() {
  let inning = localStorage.getItem("inning") || "1회초";
  let num = parseInt(inning);
  let isTop = inning.includes("초");
  let step = isTop ? 0 : 1;
  let idx = (num - 1) * 2 + step + 1;

  if (idx > 17) idx = 17;

  const innArr = [];
  for (let i = 1; i <= 9; i++) {
    innArr.push(i + "회초");
    innArr.push(i + "회말");
  }

  localStorage.setItem("inning", innArr[idx]);

  // 이닝 바뀌면 주루상황 리셋
  localStorage.setItem("base1", false);
  localStorage.setItem("base2", false);
  localStorage.setItem("base3", false);
  updateStatusDisplay();
}

function adjustInning(change) {
  let inning = localStorage.getItem("inning") || "1회초";
  let num = parseInt(inning);
  let isTop = inning.includes("초");
  let step = isTop ? 0 : 1;
  let idx = (num - 1) * 2 + step + change;

  if (idx < 0) idx = 0;
  if (idx > 17) idx = 17;

  const innArr = [];
  for (let i = 1; i <= 9; i++) {
    innArr.push(i + "회초");
    innArr.push(i + "회말");
  }

  localStorage.setItem("inning", innArr[idx]);

  // 주루상황 리셋
  localStorage.setItem("base1", false);
  localStorage.setItem("base2", false);
  localStorage.setItem("base3", false);
  updateStatusDisplay();
}

// onload 및 리셋 버튼 UI 동기화
window.onload = () => {
  updateStatusDisplay();
  document.querySelectorAll("button").forEach(btn => {
    if (btn.textContent.includes("리셋")) {
      btn.addEventListener("click", () => setTimeout(updateStatusDisplay, 100));
    }
  });
};</script><script>
const ws = new WebSocket("ws://" + location.hostname + ":8765");
ws.onopen = () => console.log("✅ WebSocket 연결됨");

function send(type, value) {
  const payload = { type, value };
  console.log("📤 전송:", payload);
  if (ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify(payload));
  } else {
    console.warn("❌ WebSocket 닫힘 상태, 전송 실패:", payload);
  }
}

function adjustCount(type, change) {
  let count = parseInt(localStorage.getItem(type) || "0");
  count += change;
  if (count < 0) count = 0;
  if (type === "ball" && count > 3) count = 3;
  if (type === "strike" && count > 2) count = 2;
  localStorage.setItem(type, count);
  document.getElementById(type).textContent = count;
  send(type, count);  // ✅ 전송 추가
}

function adjustScore(id, change) {
  let score = parseInt(localStorage.getItem(id) || "0");
  score += change;
  if (score < 0) score = 0;
  localStorage.setItem(id, score);
  document.getElementById(id).textContent = score;
  send(id, score);  // ✅ 전송 추가
}

function adjustInning(change) {
  const options = ["1회초", "1회말", "2회초", "2회말", "3회초", "3회말", "4회초", "4회말",
                   "5회초", "5회말", "6회초", "6회말", "7회초", "7회말", "8회초", "8회말", "9회초", "9회말"];
  let current = localStorage.getItem("inning") || "1회초";
  let index = options.indexOf(current);
  index = Math.min(Math.max(index + change, 0), options.length - 1);
  const next = options[index];
  localStorage.setItem("inning", next);
  document.getElementById("inning").textContent = next;
  send("inning", next);  // ✅ 전송 추가
}

document.getElementById("team1")?.addEventListener("input", e => {
  const label = document.querySelector("label[for='score1']");
  if (label) label.textContent = e.target.value + " 점수";
});
document.getElementById("team2")?.addEventListener("input", e => {
  const label = document.querySelector("label[for='score2']");
  if (label) label.textContent = e.target.value + " 점수";
});

document.getElementById("team1")?.addEventListener("input", e => {
});
document.getElementById("team2")?.addEventListener("input", e => {
});

document.getElementById("team1")?.addEventListener("input", e => {
  document.querySelectorAll(".score1-label").forEach(el => el.textContent = e.target.value);
});
document.getElementById("team2")?.addEventListener("input", e => {
  document.querySelectorAll(".score2-label").forEach(el => el.textContent = e.target.value);
});

document.getElementById("reset-ball")?.addEventListener("click", () => {
  send('ball', 0); document.getElementById('ball').textContent = '0';
});


document.getElementById("reset-strike")?.addEventListener("click", () => {
  send('strike', 0); document.getElementById('strike').textContent = '0';
});


document.getElementById("reset-out")?.addEventListener("click", () => {
  send('out', 0); document.getElementById('out').textContent = '0';
});


document.getElementById("reset-score")?.addEventListener("click", () => {
  send('score1', 0); send('score2', 0); document.getElementById('score1').textContent = '0'; document.getElementById('score2').textContent = '0';
});


document.getElementById("reset-inning")?.addEventListener("click", () => {
  send('inning', '1회초'); document.getElementById('inning').textContent = '1회초';
});


document.getElementById("reset-base")?.addEventListener("click", () => {
  send('base1', false); send('base2', false); send('base3', false);
});
</script><span id="score1">0</span><span id="score2">0</span><span id="ball">0</span><span id="strike">0</span><span id="out">0</span><span id="inning">1회초</span></body>
</html>